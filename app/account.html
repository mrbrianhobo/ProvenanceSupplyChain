<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Account</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div id="insert-navbar"></div>

    <div class="container">
        <h2>Account</h2>
        <br>
        <b><big> Name: </big><b>
        <b><big id = "name" ></big><b>
        <br>
        <b><big id = "balance-display" ></big><b>

        <br>
        <hr>    
        <h2>Manage Funds</h2>

        <br>
        <input style="max-width: 200px" id="withdraw-input" type="number" placeholder="Withdraw Amount"></input>
        <button id="withdraw-submit" type="button" class="btn btn-default">Withdraw</button>

        <br>
        <input style="max-width: 200px" id="deposit-input" type="number" placeholder="Deposit Amount"></input>
        <button id="deposit-submit" type="button" class="btn btn-default">Deposit</button>

        <br>
        <hr>
        <h2>My Items </h2><!--<small>&nbsp;<a href="#">Add Item</a></small></h2> -->

        <br>
        <input style="max-width: 200px" id="Serial-input" type="number" placeholder="Item Serial Number"></input>
        <input style="max-width: 200px" id="ItemName-input" type="text" placeholder="Item Name"></input>
        <button id="AddItem-submit" type="button" class="btn btn-default">Add Item</button>

        <br>

        <br>
        <input style="max-width: 200px" id="sell-serial-input" type="number" placeholder="Item Serial Number"></input>
        <input style="max-width: 200px" id="price-input" type="number" placeholder="Item Price"></input>
        <button id="MarkSale-submit" type="button" class="btn btn-default">Mark For Sale</button>
        <br>

        <br>
        <input style="max-width: 200px" id="undo-serial-input" type="number" placeholder="Item Serial Number"></input>
        <button id="UndoSale-submit" type="button" class="btn btn-default">Undo For Sale</button>

        <br>
        <br>
        <table class="table" id="items-table" style="width:600px">
            <th>ID</th>
            <th>Name</th>
            <th>For Sale</th>
            <th>Price</th>
            <!-- <th>Sell</th> -->
        </table>
    </div>


    <script src="./app.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript">

        var displayBalance = function() {
            var balanceString = "Current Balance: $";
            var balance = App.viewFunds();
            if (parseInt(balance)) {
                balanceString += balance;
            } else {
                balanceString += "0";
            }

            $("#balance-display").text(balanceString);
        }

        $(document).ready(function() {

            $("#insert-navbar").load("nav.html");
            displayBalance();

            $("#name").text(App.getMyName());

            $('#withdraw-submit').on('click', function(event) {
                App.withdraw();//parseInt($('#withdraw-input').val()));
                location.reload();
            });

            $('#deposit-submit').on('click', function(event) {
                App.deposit(parseInt($('#deposit-input').val()));
                location.reload();
            });

            $('#AddItem-submit').on('click', function(event) {
                App.addItem(parseInt($('#Serial-input').val()), $('#ItemName-input').val());
                location.reload();
            });

            $('#MarkSale-submit').on('click', function(event) {
                var status = App.markForSale(parseInt($('#sell-serial-input').val()), parseInt($('#price-input').val()));
                alert(status);
                location.reload();
            });

            $('#UndoSale-submit').on('click', function(event) {
                var status = App.undoForSale(parseInt($('#undo-serial-input').val()));
                alert(status);
                location.reload();
            });

            // $( ["Amoxicillin", "Pseudoephedrine", "Esomeprazole Magnesium", "Fluoxetine", "Duloxetine"] ).each(function(i, item) {
            //     var price = "<div class=\"input-group\"><span class=\"input-group-addon\">$</span><input type='text' placeholder='Price' style='max-width:150px' class=\"form-control\"></div>"
            //     $("#items-table").append("<tr><td>" + item + "</td><td>" + price + "</td><td><input type='checkbox' name='For Sale' style='width:50px'></input></td></tr>");
            // console.log(App.getItemsForSale());
            $( App.getOwnedItems() ).each(function(index, bignum) {
                id = bignum.toNumber();
                var idStr   = "<a href='/item.html?id=" + id + "'>" + id + "</a>";
                var name    = App.getItemName(id);
                var forSale = false;
                var saleList = App.getItemsForSale();
                var i ; 
                for(i =0; i < saleList.length; i++){
                    // console.log(id);
                    // console.log(saleList[i].toNumber())
                    if(id == saleList[i].toNumber()){
                        forSale = true;
                        break;
                    }
                }
                var price;
                if(forSale == false){
                    price = "Not for Sale";
                }
                else {
                    price = App.getSalePrice(id);
                }

                var sellPrice   = "<div class=\"input-group\"><span class=\"input-group-addon\">$</span><input id = \"sellprice\" type='number' placeholder='Price' style='max-width:150px' class=\"form-control\"></div>";
                var mark    = "<input type='button' name='Sell' style='width:50px'></input>";
                $("#items-table").append("<tr>" +
                                             "<td>" + idStr + "</td>" +
                                             "<td>" + name    + "</td>" +
                                             "<td>" + forSale    + "</td>" +
                                             "<td>" + price   + "</td>" +
                                             // "<td>" + sellPrice   + "</td>" +
                                             // "<td>" + mark    + "</td>" +
                                         "</tr>");
            });

            // $('#Sell').on('click', function(event) {
            //     App.markForSale(id, parseInt($('#sellprice').val()));
            //     location.reload();
            // });

        });

    </script>
  </body>
</html>
